<div id="pwd-document-instances" class="section">
<table class="tablesaw" data-tablesaw-mode="stack">
<thead>
    <tr>
        <th>Image</th>
        <th>Source</th>
        <th>Source location</th>
    </tr>
</thead>
<tbody>
<?php foreach ($documentInstances as $instance): ?>
<?php
$source = null;
if ($instance['source_id']) {
    $source = $this->api()->read('items', $instance['source_id'])->getContent();
}
$image = null;
if ($instance['image_id']) {
    $image = $this->api()->read('items', $instance['image_id'])->getContent();
}
$sourceText = [];
if ($source) {
    $sourceText[] = ucfirst($instance['source_type']);
    $sourceText[] = $source->link($source->displayTitle());
} else {
    $sourceText[] = '[no source]';
}
$imageText = [];
if ($image) {
    $imageText[] = $image->link($image->displayTitle());
    if ($image->media()) {
        $imageText[] = $this->hyperlink(
            '[open in viewer]',
            $this->url(
                'admin/pwd/viewer',
                ['document-instance-id' => $instance['id']],
                ['fragment' => $instance['page_number'] ? sprintf('page%s', $instance['page_number']) : null]
            )
        );
    } else {
        $imageText[] = '[no pages]';
    }
} else {
    $imageText[] = '[no image]';
}
?>
    <tr>
        <td><?php echo implode(' : ', $imageText); ?></td>
        <td><?php echo implode(' : ', $sourceText); ?></td>
        <td><?php echo $instance['location']; ?></td>
    </tr>
<?php endforeach; ?>
</tbody>
</table>
</div>
